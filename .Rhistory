names(agency_allq_mean)[4] <- "Mean"
names(agency_allq_sd)[4] <- "SD"
names(agency_allq_count)[4] <- "Count"
Agency_allq <- cbind(agency_allq_mean,agency_allq_sd$SD,agency_allq_count$Count )
names(Agency_allq)[4] <- "SD"
names(Agency_allq)[5] <- "Count"
Agency_allq <- na.omit(Agency_allq)
View(Agency_allq)
agency_allq_mean <- dcast(allq_fullsetm, SurveyYear.f + variable + Agency ~ ., mean, na.rm=TRUE) #mean
agency_allq_sd <- dcast(allq_fullsetm, SurveyYear.f + variable + Agency ~ ., sd, na.rm=TRUE) #standard deviation
agency_allq_count <- dcast(allq_fullsetm, SurveyYear.f + variable + Agency ~ .)
names(agency_allq_mean)[4] <- "Mean"
names(agency_allq_sd)[4] <- "SD"
names(agency_allq_count)[4] <- "Count"
Agency_allq <- cbind(agency_allq_mean,agency_allq_sd$SD,agency_allq_count$Count )
names(Agency_allq)[5] <- "SD"
names(Agency_allq)[6] <- "Count"
Agency_allq <- na.omit(Agency_allq)
Agency_2small <- dcast(allq_fullsetm, Agency + SurveyYear.f ~ .)
View(Agency_2small)
Agency_2small <- subset(Agency_allq, variable == "StateComp")
View(Agency_2small)
# List of agency names and abbreviations, to be used in file creation.
names <- c("Abraham Lincoln Presidential Library and Museum","Aging, Department on","Agriculture, Department of","Arts Council","Capital Development Board",
"Central Management Services, Department of","Children and Family Services, Department of","Civil Service Commission, Illinois",
"Commerce and Economic Opportunity, Department of","Commerce Commission, Illinois","Community College Board","Corrections, Department of",
"Criminal Justice Information Authority","Deaf and Hard of Hearing Commission, Illinois","Developmental Disabilities, Illinois Council on",
"Education, Illinois State Board of","Educational Labor Relations Board","Emergency Management Agency","Employment Security, Department of",
"Environmental Protection Agency","Financial and Professional Regulation, Department of","Gaming Board, Illinois","Guardianship and Advocacy Commission",
"Healthcare and Family Services - Formerly known as Public Aid, Dept. of","Higher Education, Board of","Human Rights Commission","Human Rights, Department of",
"Human Services, Department of","Innovation and Technology, Department of","Insurance Department of","Juvenile Justice, Department of","Labor Relations Board",
"Labor, Department of","Law Enforcement Training and Standards Board, Illinois","Liquor Control Commission","Lottery, Illinois",
"Management and Budget, Office of","Medical District Commission","Natural Resources, Department of","Other (please specify)",
"Pollution Control Board","Power Agency, Illinois","Prisoner Review Board, Illinois","Property Tax Appeal Board","Public Health, Department of",
"Racing Board, Illinois","Revenue, Department of","State Fire Marshal","State Police, Illinois","State Retirement Systems",
"Student Assistance Commission, Illinois","Toll Highway Authority, Illinois State","Transportation, Department of","Veterans Affairs, Department of",
"Volunteerism Community Service, Governor's Commission on","Workers' Compensation Commission, Illinois")
abbrevs <- c("ALPLM","AGE","AG","AC","CDB","CMS","DCFS","CSC","DCEO","ICC","ICCB","DOC","ICJIA","DHHC","CDD","ISBE","ELRB","IEMA","IDES","IEPA","IDFPR","GAM","GAC",
"HFS","IBHE","HRC","DHR","DHS","DoIT","DOI","DJJ","ILRB","DOL","LETSB","LCC","LOT","GOMB","MDC","IDNR","Other","PCB","IPA","PRB","PTAB","DPH","IRB","REV","OSFM","ISP","SRS",
"ISAC","TOL","DOT","VA","CVCS","WCC")
Xagency <- tibble(names, abbrevs)
View(Xagency)
curr_Agency <- subset(Agency_allq, Agency = Xagency$names[1])
View(curr_Agency)
Xagency$names[1]
curr_Agency <- subset(Agency_allq, Agency == Xagency$names[1])
curr_Agency <- subset(Agency_allq, Agency == Xagency$names[2])
curr_Agency <- subset(Agency_allq, Agency == Xagency$names[i])
for (i in nrow(Xagency)) {
curr_Agency <- subset(Agency_allq, Agency == Xagency$names[i])
}
curr_Agency_comps <- subset(Agency_allq, variable == c(""RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp""))
curr_Agency_comps <- subset(Agency_allq, variable == c("RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp""))
curr_Agency_comps <- subset(Agency_allq, variable == c("RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp"))
curr_Agency_comps <- subset(Agency_allq, variable == c("RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp"))
curr_Agency_comps <- subset(curr_Agency, variable == c("RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp"))
View(curr_Agency_comps)
## For loop that creates each agency's file ##
curr_Agency <- subset(Agency_allq, Agency == Xagency$names)
curr_Agency_comps <- subset(curr_Agency, variable == c("RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp"))
Xagency[28]
Xagency[28,]
Xagency$names[28,]
Xagency$names[28]
## For loop that creates each agency's file ##
curr_Agency <- subset(Agency_allq, Agency == Xagency$names[28])
curr_Agency_comps <- subset(curr_Agency, variable == c("RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp"))
curr_Agency$variable
curr_Agency$variable[145]
curr_Agency$variable[145]=="SuperComp"
curr_Agency_comps <- subset(curr_Agency, variable != c("RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp"))
curr_Agency_comps <- subset(curr_Agency, variable == "RetentionComp" | variable =="TalentComp" | variable =="EnviroComp" |
variable == "EvalComp" | variable == "CustomerComp" | variable == "UnitComp" | variable == "SuperComp" |
variable == "LeaderComp" | variable == "StateComp")
curr_Agency <- subset(curr_Agency, variable != "RetentionComp" | variable !="TalentComp" | variable !="EnviroComp" |
variable != "EvalComp" | variable != "CustomerComp" | variable != "UnitComp" | variable != "SuperComp" |
variable != "LeaderComp" | variable != "StateComp")
curr_Agency <- subset(curr_Agency, variable != "RetentionComp" & variable !="TalentComp" & variable !="EnviroComp" &
variable != "EvalComp" & variable != "CustomerComp" & variable != "UnitComp" & variable != "SuperComp" &
variable != "LeaderComp" & variable != "StateComp")
View(SOI_subset_only)
curr_Agency_comps <- subset(curr_Agency, variable == "RetentionComp" | variable =="TalentComp" | variable =="EnviroComp" |
variable == "EvalComp" | variable == "CustomerComp" | variable == "UnitComp" | variable == "SuperComp" |
variable == "LeaderComp")
## For loop that creates each agency's file ##
curr_Agency <- subset(Agency_allq, Agency == Xagency$names[28])
curr_Agency_comps <- subset(curr_Agency, variable == "RetentionComp" | variable =="TalentComp" | variable =="EnviroComp" |
variable == "EvalComp" | variable == "CustomerComp" | variable == "UnitComp" | variable == "SuperComp" |
variable == "LeaderComp")
curr_Agency <- subset(curr_Agency, variable != "RetentionComp" & variable !="TalentComp" & variable !="EnviroComp" &
variable != "EvalComp" & variable != "CustomerComp" & variable != "UnitComp" & variable != "SuperComp" &
variable != "LeaderComp" & variable != "StateComp")
curr_Agency_comps[,c(1:2,4:5)]
SOI_subset_only_rbind <- subset(SOI_subset_only, SurveyYear.f == 2017)
View(SOI_subset_only_rbind)
SOI_subset_only_rbind$SurveyYear.f <- "Statewide"
SOI_subset_only_rbind$SurveyYear.f <- factor(SOI_subset_only_rbind$SurveyYear.f)
Agency_comps_2plot <- rbind(curr_Agency_comps[,c(1:2,4:5)],SOI_subset_only_rbind)
View(Agency_comps_2plot)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title="Survey Section Composite Scores, Mean & 95% Confidence Interval", x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_SOI_subset_only)
print(p_Agency_comps)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$names[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$names[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
stvsage <- subset(Agency_comps_2plot, SurveyYear.f==2017 | SurveyYear.f=="Statewide") #delta between agency in 2017 and statewide in 2017
View(stvsage)
full_ttest <- lapply(stvsage, function(i) t.test(i ~ stvsage$SurveyYear.f))
stvsage <- subset(Agency_comps_2plot, SurveyYear.f==2017 | SurveyYear.f=="Statewide") #delta between agency in 2017 and statewide in 2017
full_ttest <- lapply(stvsage, function(i) t.test(i ~ stvsage$SurveyYear.f))
View(delfull)
View(fullsetm)
View(fullset)
stvsage <- subset(fullsetm, SurveyYear.f==2017) #delta between agency in 2017 and statewide in 2017
stvsage <- na.omit(stvsage)
stvsage$Agency == Xagency$names[28]
stvsage <- rbind(stvsage, stvsage$Agency == Xagency$names[28])
test <- stvsage$Agency == Xagency$names[28]
data.frame(test)
stvsage <- rbind(stvsage, data.frame(stvsage$Agency == Xagency$names[28]))
stvsage <- cbind(stvsage, data.frame(stvsage$Agency == Xagency$names[28]))
names(stvsage)[10] <- "Flag"
test <- lapply(stvsage, function(i) t.test(i ~ stvsage$Flag))
mean(svstage)
mean(stvsage)
stvsage <- subset(fullset, SurveyYear.f==2017) #delta between agency in 2017 and statewide in 2017
stvsage <- na.omit(stvsage)
stvsage <- cbind(stvsage, data.frame(stvsage$Agency == Xagency$names[28]))
names(stvsage)[10] <- "Flag"
test <- lapply(stvsage, function(i) t.test(i ~ stvsage$Flag))
test <- lapply(stvsage, function(i) t.test(i ~ stvsage$Flag))
stvsage <- subset(fullset, SurveyYear.f==2017) #delta between agency in 2017 and statewide in 2017
stvsage <- na.omit(stvsage)
stvsage <- cbind(stvsage, data.frame(stvsage$Agency == Xagency$names[28]))
names(stvsage)[17] <- "Flag"
# Plot results - basic plot
p_SOI_subset_only<- ggplot(SOI_subset_only, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_SOI_subset_only <- p_SOI_subset_only+labs(title="Survey Section Composite Scores, Mean & 95% Confidence Interval", x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_SOI_subset_only)
test <- lapply(stvsage[7:14], function(i) t.test(i ~ stvsage$Flag))
test
agevsst <- subset(fullset, SurveyYear.f==2017) #delta between agency in 2017 and statewide in 2017
agevsst <- na.omit(agevsst)
agevsst <- cbind(agevsst, data.frame(agevsst$Agency == Xagency$names[28]))
names(agevsst)[17] <- "Flag"
test <- lapply(agevsst[7:14], function(i) t.test(i ~ agevsst$Flag))
agevslast <- subset(fullset, SurveyYear.f==2017 | SurveyYear.f == 2016) #delta between agency in 2017 and agency in 2016
agevslast <- subset(agevslast, Agency == Xagency$names[28])
agevslast <- na.omit(agevslast)
names(agevsst)[17] <- "Flag"
test2 <- lapply(agevslast[7:14], function(i) t.test(i ~ agevslast$SurveyYear.f))
test2
View(agevsst)
- lapply(agevsst[7:14]
# t-test the two different samples
agevsst_ttest <- lapply(agevsst[7:14], function(i) t.test(i ~ agevsst$Flag))
agevslast_ttest <- lapply(agevslast[7:14], function(i) t.test(i ~ agevslast$SurveyYear.f))
View(agevslast_ttest)
# t-test the two different samples
agevsst_ttest <- lapply(agevsst[7:14], function(i) t.test(i ~ agevsst$Flag))
View(agevsst_ttest)
agency_ttest_results <- c("","","","","","","","","","","","","","","","",
agevsst_ttest$RetentionComp$p.value, agevsst_ttest$TalentComp$p.value, agevsst_ttest$EnviroComp$p.value, agevsst_ttest$EvalComp$p.value,
agevsst_ttest$CustomerComp$p.value, agevsst_ttest$UnitComp$p.value, agevsst_ttest$SuperComp$p.value, agevsst_ttest$LeaderComp$p.value,
agevslast_ttest$RetentionComp$p.value, agevslast_ttest$TalentComp$p.value, agevslast_ttest$EnviroComp$p.value, agevslast_ttest$EvalComp$p.value,
agevslast_ttest$CustomerComp$p.value, agevslast_ttest$UnitComp$p.value, agevslast_ttest$SuperComp$p.value, agevslast_ttest$LeaderComp$p.value)
CInul_age <- agency_ttest_results>0.05
CI95_age <- agency_ttest_results<=0.05 & agency_ttest_results>0.01
CI99_age <- agency_ttest_results<=0.01
agency_ttest_results <- replace(agency_ttest_results,CI99_age,"**")
agency_ttest_results <- replace(agency_ttest_results,CI95_age,"*")
agency_ttest_results <- replace(agency_ttest_results,CInul_age," ")
agency_ttest_results <- c(" "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ",
agevsst_ttest$RetentionComp$p.value, agevsst_ttest$TalentComp$p.value, agevsst_ttest$EnviroComp$p.value, agevsst_ttest$EvalComp$p.value,
agevsst_ttest$CustomerComp$p.value, agevsst_ttest$UnitComp$p.value, agevsst_ttest$SuperComp$p.value, agevsst_ttest$LeaderComp$p.value,
agevslast_ttest$RetentionComp$p.value, agevslast_ttest$TalentComp$p.value, agevslast_ttest$EnviroComp$p.value, agevslast_ttest$EvalComp$p.value,
agevslast_ttest$CustomerComp$p.value, agevslast_ttest$UnitComp$p.value, agevslast_ttest$SuperComp$p.value, agevslast_ttest$LeaderComp$p.value)
CInul_age <- agency_ttest_results>0.05
CI95_age <- agency_ttest_results<=0.05 & agency_ttest_results>0.01
CI99_age <- agency_ttest_results<=0.01
agency_ttest_results <- replace(agency_ttest_results,CI99_age,"**")
agency_ttest_results <- replace(agency_ttest_results,CI95_age,"*")
agency_ttest_results <- replace(agency_ttest_results,CInul_age," ")
Agency_comps_2plot <- cbind(Agency_comps_2plot,agency_ttest_results)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
CInul_age <- agency_ttest_results>0.05 & agency_ttest_results != " "
CI95_age <- agency_ttest_results<=0.05 & agency_ttest_results>0.01 & agency_ttest_results != " "
CI99_age <- agency_ttest_results<=0.01 & agency_ttest_results != " "
agency_ttest_results <- replace(agency_ttest_results,CI99_age,"**")
agency_ttest_results <- replace(agency_ttest_results,CI95_age,"*")
agency_ttest_results <- c(" "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ",
agevsst_ttest$RetentionComp$p.value, agevsst_ttest$TalentComp$p.value, agevsst_ttest$EnviroComp$p.value, agevsst_ttest$EvalComp$p.value,
agevsst_ttest$CustomerComp$p.value, agevsst_ttest$UnitComp$p.value, agevsst_ttest$SuperComp$p.value, agevsst_ttest$LeaderComp$p.value,
agevslast_ttest$RetentionComp$p.value, agevslast_ttest$TalentComp$p.value, agevslast_ttest$EnviroComp$p.value, agevslast_ttest$EvalComp$p.value,
agevslast_ttest$CustomerComp$p.value, agevslast_ttest$UnitComp$p.value, agevslast_ttest$SuperComp$p.value, agevslast_ttest$LeaderComp$p.value)
CInul_age <- agency_ttest_results>0.05 & agency_ttest_results != " "
CI95_age <- agency_ttest_results<=0.05 & agency_ttest_results>0.01 & agency_ttest_results != " "
CI99_age <- agency_ttest_results<=0.01 & agency_ttest_results != " "
agency_ttest_results <- replace(agency_ttest_results,CI99_age,"**")
agency_ttest_results <- replace(agency_ttest_results,CI95_age,"*")
agency_ttest_results <- replace(agency_ttest_results,CInul_age," ")
Agency_comps_2plot <- cbind(Agency_comps_2plot,agency_ttest_results)
# combine the agency's average data with the statewide average for plotting
SOI_subset_only_rbind <- subset(SOI_subset_only, SurveyYear.f == 2017)
SOI_subset_only_rbind$SurveyYear.f <- factor(SOI_subset_only_rbind$SurveyYear.f)
Agency_comps_2plot <- rbind(curr_Agency_comps[,c(1:2,4:5)],SOI_subset_only_rbind)
Agency_comps_2plot <- cbind(Agency_comps_2plot,agency_ttest_results)
## For loop that creates each agency's file ##
# select the results that belong to the agency currently being tested
curr_Agency <- subset(Agency_allq, Agency == Xagency$names[28])
# create a subset that is just the composite data
curr_Agency_comps <- subset(curr_Agency, variable == "RetentionComp" | variable =="TalentComp" | variable =="EnviroComp" |
variable == "EvalComp" | variable == "CustomerComp" | variable == "UnitComp" | variable == "SuperComp" |
variable == "LeaderComp")
# combine the agency's average data with the statewide average for plotting
SOI_subset_only_rbind <- subset(SOI_subset_only, SurveyYear.f == 2017)
# remove the composite data to leave just the questions
curr_Agency <- subset(curr_Agency, variable != "RetentionComp" & variable !="TalentComp" & variable !="EnviroComp" &
variable != "EvalComp" & variable != "CustomerComp" & variable != "UnitComp" & variable != "SuperComp" &
variable != "LeaderComp" & variable != "StateComp")
SOI_subset_only_rbind$SurveyYear.f <- factor(SOI_subset_only_rbind$SurveyYear.f)
Agency_comps_2plot <- rbind(curr_Agency_comps[,c(1:2,4:5)],SOI_subset_only_rbind)
# get the agency's subset of the full set of composite data in order to t-test
agevsst <- subset(fullset, SurveyYear.f==2017) #delta between agency in 2017 and statewide in 2017
agevsst <- na.omit(agevsst)
agevsst <- cbind(agevsst, data.frame(agevsst$Agency == Xagency$names[28]))
names(agevsst)[17] <- "Flag" # setup t-test between agency's data and all other data (the statistically correct way to do this - not including themselves in the statewide)
# get the agency's data from the past 2 years to compare
agevslast <- subset(fullset, SurveyYear.f==2017 | SurveyYear.f == 2016) #delta between agency in 2017 and agency in 2016
agevslast <- subset(agevslast, Agency == Xagency$names[28])
agevslast <- na.omit(agevslast)
# t-test the two different samples
agevsst_ttest <- lapply(agevsst[7:14], function(i) t.test(i ~ agevsst$Flag))
agevslast_ttest <- lapply(agevslast[7:14], function(i) t.test(i ~ agevslast$SurveyYear.f))
agency_ttest_results <- c(" "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ",
agevsst_ttest$RetentionComp$p.value, agevsst_ttest$TalentComp$p.value, agevsst_ttest$EnviroComp$p.value, agevsst_ttest$EvalComp$p.value,
agevsst_ttest$CustomerComp$p.value, agevsst_ttest$UnitComp$p.value, agevsst_ttest$SuperComp$p.value, agevsst_ttest$LeaderComp$p.value,
agevslast_ttest$RetentionComp$p.value, agevslast_ttest$TalentComp$p.value, agevslast_ttest$EnviroComp$p.value, agevslast_ttest$EvalComp$p.value,
agevslast_ttest$CustomerComp$p.value, agevslast_ttest$UnitComp$p.value, agevslast_ttest$SuperComp$p.value, agevslast_ttest$LeaderComp$p.value)
CInul_age <- agency_ttest_results>0.05 & agency_ttest_results != " "
CI95_age <- agency_ttest_results<=0.05 & agency_ttest_results>0.01 & agency_ttest_results != " "
CI99_age <- agency_ttest_results<=0.01 & agency_ttest_results != " "
agency_ttest_results <- replace(agency_ttest_results,CI99_age,"**")
agency_ttest_results <- replace(agency_ttest_results,CI95_age,"*")
agency_ttest_results <- replace(agency_ttest_results,CInul_age," ")
View(SOI_subset_only_rbind)
SOI_subset_only_rbind$SurveyYear.f <- replace("Statewide")
SOI_subset_only_rbind$SurveyYear.f <- replace(SOI_subset_only_rbind$SurveyYear.f,"Statewide")
SOI_subset_only_rbind$SurveyYear.f <- "Statewide"
Agency_comps_2plot <- rbind(curr_Agency_comps[,c(1:2,4:5)],SOI_subset_only_rbind)
# get the agency's subset of the full set of composite data in order to t-test
agevsst <- subset(fullset, SurveyYear.f==2017) #delta between agency in 2017 and statewide in 2017
agevsst <- na.omit(agevsst)
agevsst <- cbind(agevsst, data.frame(agevsst$Agency == Xagency$names[28]))
names(agevsst)[17] <- "Flag" # setup t-test between agency's data and all other data (the statistically correct way to do this - not including themselves in the statewide)
# get the agency's data from the past 2 years to compare
agevslast <- subset(fullset, SurveyYear.f==2017 | SurveyYear.f == 2016) #delta between agency in 2017 and agency in 2016
agevslast <- subset(agevslast, Agency == Xagency$names[28])
agevslast <- na.omit(agevslast)
# t-test the two different samples
agevsst_ttest <- lapply(agevsst[7:14], function(i) t.test(i ~ agevsst$Flag))
agevslast_ttest <- lapply(agevslast[7:14], function(i) t.test(i ~ agevslast$SurveyYear.f))
agency_ttest_results <- c(" "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ",
agevsst_ttest$RetentionComp$p.value, agevsst_ttest$TalentComp$p.value, agevsst_ttest$EnviroComp$p.value, agevsst_ttest$EvalComp$p.value,
agevsst_ttest$CustomerComp$p.value, agevsst_ttest$UnitComp$p.value, agevsst_ttest$SuperComp$p.value, agevsst_ttest$LeaderComp$p.value,
agevslast_ttest$RetentionComp$p.value, agevslast_ttest$TalentComp$p.value, agevslast_ttest$EnviroComp$p.value, agevslast_ttest$EvalComp$p.value,
agevslast_ttest$CustomerComp$p.value, agevslast_ttest$UnitComp$p.value, agevslast_ttest$SuperComp$p.value, agevslast_ttest$LeaderComp$p.value)
CInul_age <- agency_ttest_results>0.05 & agency_ttest_results != " "
CI95_age <- agency_ttest_results<=0.05 & agency_ttest_results>0.01 & agency_ttest_results != " "
CI99_age <- agency_ttest_results<=0.01 & agency_ttest_results != " "
agency_ttest_results <- replace(agency_ttest_results,CI99_age,"**")
agency_ttest_results <- replace(agency_ttest_results,CI95_age,"*")
agency_ttest_results <- replace(agency_ttest_results,CInul_age," ")
Agency_comps_2plot <- cbind(Agency_comps_2plot,agency_ttest_results)
names(Agency_comps_2plot)[5] <- "sig"
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_label(aes(label=sig), position = position_nudge(y = 0.5))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_nudge(y = 0.5))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(y = 0.5))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 2))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1, height = 0.5))
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1))
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1), vjust = 0.5)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1), vjust = 1)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1), vjust = -1)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1.2), vjust = -1)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1.1), vjust = -1)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
# Plot results - basic plot
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1.1), vjust = -1)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[28],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score",
caption = "Significance: * indicates 95% certainty that the % change is due to actual shifts in responses, while ** indicates 99% certainty.\nAn * over 2017 indicates significant change from 2016 to 2017, while over * indicates a significant difference from the statewide population.")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
