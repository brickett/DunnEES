update()
install.packages(c("boot", "foreign", "Matrix", "mgcv"))
library(RODBC)
library(RODBC)
db_path = "C:/Users/bjr21/Documents/GitHub/DunnEES/PastSurveyNumbersDB.accdb"
odbcConnectAccess(db_path)
#Import packages
library(readxl)
library(broom)
library(tibble)
library(xlsx)
#set directory to GitHub repo
setwd("C:/Users/bjr21/Documents/GitHub/DunnEES")
#set number of years
years <- c("2015","2016","2017")
#Import file
df_2017 <- read_excel("2017EESStatsData.xlsx", sheet=2)
df_2016 <- read_excel("2016EESStats.xlsx", sheet=3)
df_2016 <- read_excel("2016EESStats.xlsx", sheet=2)
View(df_2016)
df_2016 <- read_excel("2016EESStats.xlsx", sheet=3)
View(df_2016)
df_2015 <- read_excel("2015EESStats.xlsx", sheet=2)
View(df_2015)
View(df_2017)
df_2016 <- read_excel("2016EESStats.xlsx", sheet=4)
#Import file
df_2017 <- read_excel("2017EESStatsData.xlsx", sheet=1)
df_2016 <- read_excel("2016EESStats.xlsx", sheet=4)
df_2015 <- read_excel("2015EESStats.xlsx", sheet=2)
#Import file
df_2017 <- read_excel("2017EESStatsData.xlsx", sheet=1)
test_2017 <- df_2017[keeps_2017]
#Clean & combine
keeps_2017 <- c("SurveyYear", "Sex", "Race", "OtherRace", "Tenure", "Union", "Agency", "OtherAgency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
test_2017 <- df_2017[keeps_2017]
View(test_2017)
complete.cases(test_2017)
test_2017 <- test2017[complete.cases(test_2017), ]
#Clean & combine
keeps_2017 <- c("SurveyYear", "Sex", "Race", "OtherRace", "Tenure", "Union", "Agency", "OtherAgency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
test_2017 <- df_2017[keeps_2017]
test_2017 <- test2017[complete.cases(test_2017), ]
test_2017 <- test_2017[complete.cases(test_2017), ]
View(test_2017)
test_2017 <- test_2017[!(rowSums(is.na(df))==NCOL(test_2017)),]
View(test_2017)
#Clean & combine
keeps_2017 <- c("SurveyYear", "Sex", "Race", "OtherRace", "Tenure", "Union", "Agency", "OtherAgency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
comps_2017 <- df_2017[keeps_2017]
comps_2017 <- comps_2017[rowSums(is.na(comps_2017))!=ncol(comps_2017), ]
names(df_2016)[2] <- "Sex"
names(df_2016)[3] <- "Race"
names(df_2016)[4] <- "OtherRace"
names(df_2016)[5] <- "Tenure"
names(df_2016)[6] <- "Union"
names(df_2016)[7] <- "Agency"
names(df_2016)[8] <- "OtherAgency"
names(df_2016)[8] <- "OtherAgency"
names(df_2016)[130] <- "RetentionComp"
names(df_2016)[135] <- "TalentComp"
names(df_2016)[144] <- "EnviroComp"
names(df_2016)[153] <- "EvalComp"
names(df_2016)[159] <- "CustomerComp"
names(df_2016)[166] <- "UnitComp"
names(df_2016)[173] <- "SuperComp"
names(df_2016)[181] <- "LeaderComp"
names(df_2016)[182] <- "StateComp"
keeps_2016 <- c("SurveyYear", "Sex", "Race", "OtherRace", "Tenure", "Union", "Agency", "OtherAgency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
comps_2016 <- df_2016[keeps_2016]
comps_2016 <- comps_2016[rowSums(is.na(comps_2016))!=ncol(comps_2016), ]
View(comps_2016)
names(df_2016)[2] <- "Sex"
names(df_2016)[3] <- "Race"
names(df_2016)[4] <- "Tenure"
names(df_2016)[6] <- "Union"
names(df_2016)[7] <- "Agency"
names(df_2016)[126] <- "RetentionComp"
names(df_2016)[131] <- "TalentComp"
#Import file
df_2017 <- read_excel("2017EESStatsData.xlsx", sheet=1)
df_2016 <- read_excel("2016EESStats.xlsx", sheet=4)
df_2015 <- read_excel("2015EESStats.xlsx", sheet=2)
#Clean & combine
keeps_2017 <- c("SurveyYear", "Sex", "Race", "Tenure", "Union", "Agency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
comps_2017 <- df_2017[keeps_2017]
comps_2017 <- comps_2017[rowSums(is.na(comps_2017))!=ncol(comps_2017), ]
names(df_2016)[2] <- "Sex"
names(df_2016)[3] <- "Race"
names(df_2016)[4] <- "OtherRace"
names(df_2016)[5] <- "Tenure"
names(df_2016)[6] <- "Union"
names(df_2016)[7] <- "Agency"
names(df_2016)[8] <- "OtherAgency"
names(df_2016)[130] <- "RetentionComp"
names(df_2016)[135] <- "TalentComp"
names(df_2016)[144] <- "EnviroComp"
names(df_2016)[153] <- "EvalComp"
names(df_2016)[159] <- "CustomerComp"
names(df_2016)[166] <- "UnitComp"
names(df_2016)[173] <- "SuperComp"
names(df_2016)[181] <- "LeaderComp"
names(df_2016)[182] <- "StateComp"
keeps_2016 <- c("SurveyYear", "Sex", "Race", "Tenure", "Union", "Agency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
comps_2016 <- df_2016[keeps_2016]
comps_2016 <- comps_2016[rowSums(is.na(comps_2016))!=ncol(comps_2016), ]
names(df_2015)[2] <- "Sex"
names(df_2015)[3] <- "Race"
names(df_2015)[4] <- "Tenure"
names(df_2015)[6] <- "Union"
names(df_2015)[7] <- "Agency"
names(df_2015)[126] <- "RetentionComp"
names(df_2015)[131] <- "TalentComp"
names(df_2015)[140] <- "EnviroComp"
names(df_2015)[149] <- "EvalComp"
names(df_2015)[155] <- "CustomerComp"
names(df_2015)[162] <- "UnitComp"
names(df_2015)[177] <- "LeaderComp"
names(df_2015)[169] <- "SuperComp"
names(df_2015)[179] <- "StateComp"
keeps_2015 <- c("SurveyYear", "Sex", "Race", "Tenure", "Union", "Agency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
comps_2015 <- df_2015[keeps_2015]
comps_2015 <- comps_2015[rowSums(is.na(comps_2015))!=ncol(comps_2015), ]
fullset <- rbind(comps_2015, comps_2016, comps_2017)
View(fullset)
#Import packages
library(readxl)
library(broom)
library(tibble)
library(xlsx)
#set directory to GitHub repo
setwd("C:/Users/bjr21/Documents/GitHub/DunnEES")
#set number of years
years <- c("2015","2016","2017")
#Import file
df_2017 <- read_excel("2017EESStatsData.xlsx", sheet=1)
df_2016 <- read_excel("2016EESStats.xlsx", sheet=4)
df_2015 <- read_excel("2015EESStats.xlsx", sheet=2)
#Clean & combine
keeps_2017 <- c("SurveyYear", "Sex", "Race", "Tenure", "Union", "Agency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
comps_2017 <- df_2017[keeps_2017]
comps_2017 <- comps_2017[rowSums(is.na(comps_2017))!=ncol(comps_2017), ]
names(df_2016)[2] <- "Sex"
names(df_2016)[3] <- "Race"
names(df_2016)[4] <- "OtherRace"
names(df_2016)[5] <- "Tenure"
names(df_2016)[6] <- "Union"
names(df_2016)[7] <- "Agency"
names(df_2016)[8] <- "OtherAgency"
names(df_2016)[130] <- "RetentionComp"
names(df_2016)[135] <- "TalentComp"
names(df_2016)[144] <- "EnviroComp"
names(df_2016)[153] <- "EvalComp"
names(df_2016)[159] <- "CustomerComp"
names(df_2016)[166] <- "UnitComp"
names(df_2016)[173] <- "SuperComp"
names(df_2016)[181] <- "LeaderComp"
names(df_2016)[182] <- "StateComp"
keeps_2016 <- c("SurveyYear", "Sex", "Race", "Tenure", "Union", "Agency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
comps_2016 <- df_2016[keeps_2016]
comps_2016 <- comps_2016[rowSums(is.na(comps_2016))!=ncol(comps_2016), ]
names(df_2015)[2] <- "Sex"
names(df_2015)[3] <- "Race"
names(df_2015)[4] <- "Tenure"
names(df_2015)[6] <- "Union"
names(df_2015)[7] <- "Agency"
names(df_2015)[126] <- "RetentionComp"
names(df_2015)[131] <- "TalentComp"
names(df_2015)[140] <- "EnviroComp"
names(df_2015)[149] <- "EvalComp"
names(df_2015)[155] <- "CustomerComp"
names(df_2015)[169] <- "SuperComp"
names(df_2015)[162] <- "UnitComp"
names(df_2015)[177] <- "LeaderComp"
names(df_2015)[179] <- "StateComp"
keeps_2015 <- c("SurveyYear", "Sex", "Race", "Tenure", "Union", "Agency", "RetentionComp", "TalentComp", "EnviroComp", "EvalComp", "CustomerComp", "UnitComp", "SuperComp", "LeaderComp", "StateComp")
comps_2015 <- df_2015[keeps_2015]
comps_2015 <- comps_2015[rowSums(is.na(comps_2015))!=ncol(comps_2015), ]
fullset <- rbind(comps_2015, comps_2016, comps_2017)
#Calculate means
attach(fullset)
aggdata <-aggregate(fullset, by=list(SurveyYear),
FUN=mean, na.rm=TRUE)
print(aggdata)
detach(fullset)
ggplot(data=fullset)
ggplot2::ggplot(data=fullset)
?ggplot2::stat_bin
ggplot2::ggplot(data = fullset) +
stat_summary(
mapping = aes(x = SurveyYear, y = StateComp),
fun.y = median
)
library(ggplot2)
ggplot(data = fullset) +
stat_summary(
mapping = aes(x = SurveyYear, y = StateComp),
fun.y = median
)
ggplot(data = fullset) +
stat_summary(
mapping = aes(x = SurveyYear, y = StateComp),
)
ggplot(data = fullset) +
stat_summary(
mapping = aes(x = SurveyYear, y = StateComp),
fun.y = mean
)
View(aggdata)
aggdata2 <-aggregate(fullset, by=list(SurveyYear),
FUN=sd, na.rm=TRUE)
#Calculate means
attach(fullset)
aggdata <-aggregate(fullset, by=list(SurveyYear),
FUN=mean, na.rm=TRUE)
aggdata2 <-aggregate(fullset, by=list(SurveyYear),
FUN=sd, na.rm=TRUE)
detach(fullset)
View(aggdata)
View(aggdata2)
library(reshape2)
melt(data=fullset, id.vars = "SurveyYear")
fullsetm <- melt(data=fullset, id.vars = c("SurveyYear", "Sex", "Race", "Tenure", "Union", "Agency"))
View(fullsetm)
dcast(data = fullsetm, "SurveyYear" ~ . ,function(x) c(mean = mean(x), sd = sd(x)))
dcast(data = fullsetm, "SurveyYear" ~ . ,mean))
dcast(data = fullsetm, "SurveyYear" ~ . ,mean)
dcast(data = fullsetm, "SurveyYear" ~ variable ,mean)
dcast(data = fullsetm, "SurveyYear" + variable ~ . ,mean)
dcast(data = fullsetm, "SurveyYear" + variable ~ ... ,mean)
dcast(data = fullsetm, "SurveyYear" + variable ~ . ,mean)
View(fullset)
dcast(data = fullsetm, "SurveyYear" ~ variable,mean)
fullset$SurveyYear <- factor(fullset$SurveyYear)
is.factor(fullset$SurveyYear)
dcast(data = fullsetm, "SurveyYear" ~ variable,mean)
#Calculate aggregate statistics
fullsetm <- melt(data=fullset, id.vars = c("SurveyYear", "Sex", "Race", "Tenure", "Union", "Agency"))
dcast(data = fullsetm, "SurveyYear" ~ variable,mean)
fullset <- rbind(comps_2015, comps_2016, comps_2017)
fullset$Sex <- factor(fullset$Sex)
fullset$Race <- factor(fullset$Race)
fullset$Tenure <- factor(fullset$Tenure)
fullset$Union <- factor(fullset$Union)
fullset$Agency <- factor(fullset$Agency)
#Calculate aggregate statistics
fullsetm <- melt(data=fullset, id.vars = c("SurveyYear", "Sex", "Race", "Tenure", "Union", "Agency"))
is.factor(fullset$Race)
dcast(fullsetm, SurveyYear + Sex ~ ...)
dcast(fullsetm, SurveyYear + Sex + Race + Tenure + Union + Agency ~ ...)
dcast(fullsetm, SurveyYear + Sex + Race + Tenure + Union + Agency ~ ..., mean)
aggtest <- dcast(fullsetm, SurveyYear + Sex + Race + Tenure + Union + Agency ~ ..., mean)
View(aggtest)
View(aggdata)
aggtest <- dcast(fullsetm, SurveyYear ~ RetentionComp + TalentComp + EnviroComp + EvalComp + CustomerComp + UnitComp + SuperComp + LeaderComp + StateComp, mean)
aggtest <- dcast(fullsetm, SurveyYear ~ variables, mean)
aggtest <- dcast(fullsetm, SurveyYear ~ variable, mean)
aggtest <- dcast(fullsetm, SurveyYear ~ variable, mean(x, na.rm = TRUE))
aggtest <- dcast(fullsetm, SurveyYear ~ variable, mean(, na.rm = TRUE))
aggtest <- dcast(fullsetm, SurveyYear ~ variable, mean, na.rm = TRUE)
is.na(fullsetm$SurveyYear)
sum(is.na(fullsetm$SurveyYear))
View(df_2015)
View(df_2016)
View(df_2017)
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., mean(, na.rm = TRUE))
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., mean, na.rm = TRUE)
View(aggtest2)
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., c(mean(x), sd(x)), na.rm = TRUE)
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., c(mean, sd), na.rm = TRUE)
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., function (x) c(mean(x), sd(x)), na.rm = TRUE)
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., function(x) c(mean(x), sd(x)), na.rm = TRUE)
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., function(x) c(mean(x, na.rm=TRUE), sd(x, na.rm=TRUE)), na.rm = TRUE)
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., function(x) c(mean(x, na.rm=TRUE), sd(x, na.rm=TRUE)))
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., sd, na.rm=TRUE)
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., sd, na.rm=TRUE)
aggtest <- dcast(fullsetm, SurveyYear + variable ~ ., mean, na.rm=TRUE)
aggtest2 <- dcast(fullsetm, SurveyYear + variable ~ ., sd, na.rm=TRUE)
