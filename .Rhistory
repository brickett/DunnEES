# Cleaned up bar plot
p_age_allq_Unit <- p_age_allq_Unit+labs(title="Work Unit Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Unit)
picname <- paste(Xagency$abbrevs[i],"_WorkUnit.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# Plot results - Supervision - basic plot
p_age_allq_Sup<- ggplot(age_allq_Sup, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Sup <- p_age_allq_Sup+labs(title="Supervision Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Sup)
picname <- paste(Xagency$abbrevs[i],"_Supervisor.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# Plot results - Leadership - basic plot
p_age_allq_Lead <- ggplot(age_allq_Lead, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Lead <- p_age_allq_Lead+labs(title="Leadership Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Lead)
picname <- paste(Xagency$abbrevs[i],"_Leadership.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
}
else if (numyears == 3) {
# select the results that belong to the agency currently being tested
curr_Agency <- subset(Agency_allq, Agency == Xagency$names[i])
# create a subset that is just the composite data
curr_Agency_comps <- subset(curr_Agency, variable == "RetentionComp" | variable =="TalentComp" | variable =="EnviroComp" |
variable == "EvalComp" | variable == "CustomerComp" | variable == "UnitComp" | variable == "SuperComp" |
variable == "LeaderComp")
curr_Agency_state <- subset(curr_Agency, variable == "StateComp")
# remove the composite data to leave just the questions
curr_Agency <- subset(curr_Agency, variable != "RetentionComp" & variable !="TalentComp" & variable !="EnviroComp" &
variable != "EvalComp" & variable != "CustomerComp" & variable != "UnitComp" & variable != "SuperComp" &
variable != "LeaderComp" & variable != "StateComp")
# Add the breakpoint into each question
brkpt <-round(stri_length(curr_Agency$variable)/2, digits=0) #add breakpoint for plotting - splits halfway through question
stri_sub(curr_Agency$variable,brkpt+1,brkpt) <- "-\n"
# combine the agency's average data with the statewide average for plotting
SOI_subset_only_rbind <- subset(SOI_subset_only, SurveyYear.f == 2017)
SOI_subset_only_rbind$SurveyYear.f <- factor(SOI_subset_only_rbind$SurveyYear.f)
SOI_subset_only_rbind$SurveyYear.f <- "Statewide"
Agency_comps_2plot <- rbind(curr_Agency_comps[,c(1:2,4:5)],SOI_subset_only_rbind)
SOI_state_only_rbind <- subset(SOI_state_only, SurveyYear.f == 2017)
SOI_state_only_rbind$SurveyYear.f <- factor(SOI_state_only_rbind$SurveyYear.f)
SOI_state_only_rbind$SurveyYear.f <- "Statewide"
Agency_state_2plot <- rbind(curr_Agency_state[,c(1:2,4:5)],SOI_state_only_rbind)
# get the agency's subset of the full set of composite data in order to t-test
agevsst <- subset(fullset, SurveyYear.f==2017) #delta between agency in 2017 and statewide in 2017
agevsst <- na.omit(agevsst)
agevsst <- cbind(agevsst, data.frame(agevsst$Agency == Xagency$names[i]))
names(agevsst)[17] <- "Flag" # setup t-test between agency's data and all other data (the statistically correct way to do this - not including themselves in the statewide)
# get the agency's data from the past 2 years to compare
agevslast <- subset(fullset, SurveyYear.f==2017 | SurveyYear.f == 2016) #delta between agency in 2017 and agency in 2016
agevslast <- subset(agevslast, Agency == Xagency$names[i])
agevslast <- na.omit(agevslast)
# t-test the two different samples
agevsst_ttest <- lapply(agevsst[7:15], function(i) t.test(i ~ agevsst$Flag))
agevslast_ttest <- lapply(agevslast[7:15], function(i) t.test(i ~ agevslast$SurveyYear.f))
# extract the p-values
agency_ttest_results <- c(agevsst_ttest$RetentionComp$p.value, agevsst_ttest$TalentComp$p.value, agevsst_ttest$EnviroComp$p.value, agevsst_ttest$EvalComp$p.value,
agevsst_ttest$CustomerComp$p.value, agevsst_ttest$UnitComp$p.value, agevsst_ttest$SuperComp$p.value, agevsst_ttest$LeaderComp$p.value,
agevslast_ttest$RetentionComp$p.value, agevslast_ttest$TalentComp$p.value, agevslast_ttest$EnviroComp$p.value, agevslast_ttest$EvalComp$p.value,
agevslast_ttest$CustomerComp$p.value, agevslast_ttest$UnitComp$p.value, agevslast_ttest$SuperComp$p.value, agevslast_ttest$LeaderComp$p.value)
# test signficance from p-values
CInul_age <- agency_ttest_results>0.05 & agency_ttest_results != " "
CI95_age <- agency_ttest_results<=0.05 & agency_ttest_results>0.01 & agency_ttest_results != " "
CI99_age <- agency_ttest_results<=0.01 & agency_ttest_results != " "
# convert to significance level
agency_ttest_results <- replace(agency_ttest_results,CI99_age,"**")
agency_ttest_results <- replace(agency_ttest_results,CI95_age,"*")
agency_ttest_results <- replace(agency_ttest_results,CInul_age," ")
agency_ttest_results<- c(" "," "," "," "," "," "," "," "," "," "," "," "," "," "," "," ",agency_ttest_results)
# bind significance level to the plotting data
Agency_comps_2plot <- cbind(Agency_comps_2plot,agency_ttest_results)
names(Agency_comps_2plot)[5] <- "sig"
# Plot results - basic plot: composite scores
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1.1), vjust = -1)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[i],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score",
caption = "Significance: * indicates 95% certainty that the % change is due to actual shifts in responses, while ** indicates 99% certainty.\nAn * over 2017 indicates significant change from 2016 to 2017, while over Statewide indicates a significant difference from the statewide population.")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
#print(p_Agency_comps)
picname <- paste(Xagency$abbrevs[i],"_Composite.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# extract the p-values
agency_ttest_state <- c(agevslast_ttest$StateComp$p.value, agevsst_ttest$StateComp$p.value)
# test signficance from p-values
CInul_age_st <- agency_ttest_state>0.05 & agency_ttest_state != " "
CI95_age_st <- agency_ttest_state<=0.05 & agency_ttest_state>0.01 & agency_ttest_state != " "
CI99_age_st <- agency_ttest_state<=0.01 & agency_ttest_state != " "
# convert to significance level
agency_ttest_state <- replace(agency_ttest_state,CI99_age_st,"**")
agency_ttest_state <- replace(agency_ttest_state,CI95_age_st,"*")
agency_ttest_state <- replace(agency_ttest_state,CInul_age_st," ")
agency_ttest_state <- c(" ", " ", agency_ttest_state)
# bind significance level to the plotting data
Agency_state_2plot <- cbind(Agency_state_2plot,agency_ttest_state)
names(Agency_state_2plot)[5] <- "sig"
# Plot results - basic plot: statewide scores
p_Agency_state<- ggplot(Agency_state_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1.1), vjust = -1)
# Cleaned up bar plot
p_Agency_state <- p_Agency_state+labs(title=paste(Xagency$abbrevs[i],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Statewide Composite Score", y = "Average Composite Score",
caption = "Significance: * indicates 95% certainty that the % change is due to actual shifts in responses, while ** indicates 99% certainty.\nAn * over 2017 indicates significant change from 2016 to 2017, while over Statewide indicates a significant difference from the statewide population.")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels="Statewide Composite Score")
#print(p_Agency_state)
picname <- paste(Xagency$abbrevs[i],"_StatewideComposite.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
## Plot out the question results over time ##
# Create filters based on variable names (flexible instead of using the numbering subsetting format)
filter_allq_Ret <- SOI_allq$variable[c(1:5,52:56,103:107)]
filter_allq_Tal <- SOI_allq$variable[c(7:9,58:60,109:111)]
filter_allq_Env <- SOI_allq$variable[c(11:17,62:68,113:119)]
filter_allq_Eval <- SOI_allq$variable[c(19:25,70:76,121:127)]
filter_allq_Cust <- SOI_allq$variable[c(27:30,78:81,129:132)]
filter_allq_Unit <- SOI_allq$variable[c(32:36,83:87,134:138)]
filter_allq_Sup <- SOI_allq$variable[c(38:42,89:93,140:144)]
filter_allq_Lead <- SOI_allq$variable[c(44:49,95:100,146:151)]
# Get subset for plotting using dplyr functions
age_allq_Ret <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Ret)
age_allq_Tal <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Tal)
age_allq_Env <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Env)
age_allq_Eval <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Eval)
age_allq_Cust <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Cust)
age_allq_Unit <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Unit)
age_allq_Sup <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Sup)
age_allq_Lead <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Lead)
# Plot results - Retention & Satisfaction - basic plot
p_age_allq_Ret<- ggplot(age_allq_Ret, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Ret <- p_age_allq_Ret+labs(title="Retention & Satisfaction Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Ret)
picname <- paste(Xagency$abbrevs[i],"_Retention.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# Plot results - Talent Development - basic plot
p_age_allq_Tal<- ggplot(age_allq_Tal, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Tal <- p_age_allq_Tal+labs(title="Talent Development Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Tal)
picname <- paste(Xagency$abbrevs[i],"_Talent.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# Plot results - Work Environment - basic plot
p_age_allq_Env<- ggplot(age_allq_Env, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Env <- p_age_allq_Env+labs(title="Work Environment Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Env)
picname <- paste(Xagency$abbrevs[i],"_WorkEnvironment.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# Plot results - Worker Evaluations - basic plot
p_age_allq_Eval <- ggplot(age_allq_Eval, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Eval <- p_age_allq_Eval+labs(title="Worker Evaluations Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Eval)
picname <- paste(Xagency$abbrevs[i],"_Evaluations.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# Plot results - Customer Interactions - basic plot
p_age_allq_Cust<- ggplot(age_allq_Cust, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Cust <- p_age_allq_Cust+labs(title="Customer Interactions Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Cust)
picname <- paste(Xagency$abbrevs[i],"_Customer.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# Plot results - Work Unit - basic plot
p_age_allq_Unit<- ggplot(age_allq_Unit, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Unit <- p_age_allq_Unit+labs(title="Work Unit Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Unit)
picname <- paste(Xagency$abbrevs[i],"_WorkUnit.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# Plot results - Supervision - basic plot
p_age_allq_Sup<- ggplot(age_allq_Sup, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Sup <- p_age_allq_Sup+labs(title="Supervision Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Sup)
picname <- paste(Xagency$abbrevs[i],"_Supervisor.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
# Plot results - Leadership - basic plot
p_age_allq_Lead <- ggplot(age_allq_Lead, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Lead <- p_age_allq_Lead+labs(title="Leadership Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Lead)
picname <- paste(Xagency$abbrevs[i],"_Leadership.jpg")
#ggsave(picname, plot = last_plot(), device = "jpeg", path = NULL, width = 10, height = 4, units = "in", dpi = 600, limitsize = TRUE)
}
}
Q
test
names
clear
source('~/GitHub/DunnEES/AgencyTrends.R', echo=TRUE)
source('~/GitHub/DunnEES/AgencyTrends.R', echo=TRUE)
i <- 29
print(paste(Xagency$names[i],"has two (2) years."))
i <- 29
print(paste(Xagency$names[i],"has two (2) years."))
# select the results that belong to the agency currently being tested
curr_Agency <- subset(Agency_allq, Agency == Xagency$names[i])
# create a subset that is just the composite data
curr_Agency_comps <- subset(curr_Agency, variable == "RetentionComp" | variable =="TalentComp" | variable =="EnviroComp" |
variable == "EvalComp" | variable == "CustomerComp" | variable == "UnitComp" | variable == "SuperComp" |
variable == "LeaderComp")
curr_Agency_state <- subset(curr_Agency, variable == "StateComp")
# remove the composite data to leave just the questions
curr_Agency <- subset(curr_Agency, variable != "RetentionComp" & variable !="TalentComp" & variable !="EnviroComp" &
variable != "EvalComp" & variable != "CustomerComp" & variable != "UnitComp" & variable != "SuperComp" &
variable != "LeaderComp" & variable != "StateComp")
# Add the breakpoint into each question
brkpt <-round(stri_length(curr_Agency$variable)/2, digits=0) #add breakpoint for plotting - splits halfway through question
stri_sub(curr_Agency$variable,brkpt+1,brkpt) <- "-\n"
# combine the agency's average data with the statewide average for plotting
SOI_subset_only_rbind <- subset(SOI_subset_only, SurveyYear.f == 2017)
SOI_subset_only_rbind$SurveyYear.f <- factor(SOI_subset_only_rbind$SurveyYear.f)
SOI_subset_only_rbind$SurveyYear.f <- "Statewide"
Agency_comps_2plot <- rbind(curr_Agency_comps[,c(1:2,4:5)],SOI_subset_only_rbind)
SOI_state_only_rbind <- subset(SOI_state_only, SurveyYear.f == 2017)
SOI_state_only_rbind$SurveyYear.f <- factor(SOI_state_only_rbind$SurveyYear.f)
SOI_state_only_rbind$SurveyYear.f <- "Statewide"
Agency_state_2plot <- rbind(curr_Agency_state[,c(1:2,4:5)],SOI_state_only_rbind)
# get the agency's subset of the full set of composite data in order to t-test
agevsst <- subset(fullset, SurveyYear.f==2017) #delta between agency in 2017 and statewide in 2017
agevsst <- na.omit(agevsst)
agevsst <- cbind(agevsst, data.frame(agevsst$Agency == Xagency$names[i]))
names(agevsst)[17] <- "Flag" # setup t-test between agency's data and all other data (the statistically correct way to do this - not including themselves in the statewide)
# get the agency's data from the past 2 years to compare
agevslast <- subset(fullset, SurveyYear.f==2017 | SurveyYear.f == 2016) #delta between agency in 2017 and agency in 2016
agevslast <- subset(agevslast, Agency == Xagency$names[i])
agevslast <- na.omit(agevslast)
# t-test the two different samples
agevsst_ttest <- lapply(agevsst[7:15], function(i) t.test(i ~ agevsst$Flag))
agevslast_ttest <- lapply(agevslast[7:15], function(i) t.test(i ~ agevslast$SurveyYear.f))
# extract the p-values
agency_ttest_results <- c(agevsst_ttest$RetentionComp$p.value, agevsst_ttest$TalentComp$p.value, agevsst_ttest$EnviroComp$p.value, agevsst_ttest$EvalComp$p.value,
agevsst_ttest$CustomerComp$p.value, agevsst_ttest$UnitComp$p.value, agevsst_ttest$SuperComp$p.value, agevsst_ttest$LeaderComp$p.value,
agevslast_ttest$RetentionComp$p.value, agevslast_ttest$TalentComp$p.value, agevslast_ttest$EnviroComp$p.value, agevslast_ttest$EvalComp$p.value,
agevslast_ttest$CustomerComp$p.value, agevslast_ttest$UnitComp$p.value, agevslast_ttest$SuperComp$p.value, agevslast_ttest$LeaderComp$p.value)
# test signficance from p-values
CInul_age <- agency_ttest_results>0.05 & agency_ttest_results != " "
CI95_age <- agency_ttest_results<=0.05 & agency_ttest_results>0.01 & agency_ttest_results != " "
CI99_age <- agency_ttest_results<=0.01 & agency_ttest_results != " "
# convert to significance level
agency_ttest_results <- replace(agency_ttest_results,CI99_age,"**")
agency_ttest_results <- replace(agency_ttest_results,CI95_age,"*")
agency_ttest_results <- replace(agency_ttest_results,CInul_age," ")
agency_ttest_results<- c(" "," "," "," "," "," "," "," ",agency_ttest_results)
# bind significance level to the plotting data
Agency_comps_2plot <- cbind(Agency_comps_2plot,agency_ttest_results)
names(Agency_comps_2plot)[5] <- "sig"
# Plot results - basic plot: composite scores
p_Agency_comps<- ggplot(Agency_comps_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1.1), vjust = -1)
# Cleaned up bar plot
p_Agency_comps <- p_Agency_comps+labs(title=paste(Xagency$abbrevs[i],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Survey Focus", y = "Average Composite Score",
caption = "Significance: * indicates 95% certainty that the % change is due to actual shifts in responses, while ** indicates 99% certainty.\nAn * over 2017 indicates significant change from 2016 to 2017, while over Statewide indicates a significant difference from the statewide population.")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels=c("Retention & Satisfaction", "Talent Development", "Work Environment", "Worker Evaluations", "Customer Interactions", "Work Unit", "Supervision", "Leadership"))  +
theme(axis.text.x=element_text(angle=30, hjust=1))
print(p_Agency_comps)
#print(p_Agency_comps)
picname <- paste(Xagency$abbrevs[i],"_Composite.jpg")
# extract the p-values
agency_ttest_state <- c(agevslast_ttest$StateComp$p.value, agevsst_ttest$StateComp$p.value)
# test signficance from p-values
CInul_age_st <- agency_ttest_state>0.05 & agency_ttest_state != " "
CI95_age_st <- agency_ttest_state<=0.05 & agency_ttest_state>0.01 & agency_ttest_state != " "
CI99_age_st <- agency_ttest_state<=0.01 & agency_ttest_state != " "
# convert to significance level
agency_ttest_state <- replace(agency_ttest_state,CI99_age_st,"**")
agency_ttest_state <- replace(agency_ttest_state,CI95_age_st,"*")
agency_ttest_state <- replace(agency_ttest_state,CInul_age_st," ")
agency_ttest_state <- c(" ", agency_ttest_state)
# bind significance level to the plotting data
Agency_state_2plot <- cbind(Agency_state_2plot,agency_ttest_state)
names(Agency_state_2plot)[5] <- "sig"
# Plot results - basic plot: statewide scores
p_Agency_state<- ggplot(Agency_state_2plot, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))+
geom_text(aes(label=sig), position = position_dodge(width = 1.1), vjust = -1)
# Cleaned up bar plot
p_Agency_state <- p_Agency_state+labs(title=paste(Xagency$abbrevs[i],"Survey Section Composite Scores, Mean & 95% Confidence Interval",sep = ", "), x="Statewide Composite Score", y = "Average Composite Score",
caption = "Significance: * indicates 95% certainty that the % change is due to actual shifts in responses, while ** indicates 99% certainty.\nAn * over 2017 indicates significant change from 2016 to 2017, while over * indicates a significant difference from the statewide population.")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
scale_x_discrete(labels="Statewide Composite Score")
print(p_Agency_state)
#print(p_Agency_state)
picname <- paste(Xagency$abbrevs[i],"_StatewideComposite.jpg")
# Create filters based on variable names (flexible instead of using the numbering subsetting format)
filter_allq_Ret <- SOI_allq$variable[c(52:56,103:107)]
filter_allq_Tal <- SOI_allq$variable[c(58:60,109:111)]
filter_allq_Env <- SOI_allq$variable[c(62:68,113:119)]
filter_allq_Cust <- SOI_allq$variable[c(78:81,129:132)]
filter_allq_Unit <- SOI_allq$variable[c(83:87,134:138)]
filter_allq_Eval <- SOI_allq$variable[c(70:76,121:127)]
filter_allq_Sup <- SOI_allq$variable[c(89:93,140:144)]
filter_allq_Lead <- SOI_allq$variable[c(95:100,146:151)]
# Get subset for plotting using dplyr functions
age_allq_Ret <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Ret)
age_allq_Tal <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Tal)
age_allq_Env <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Env)
age_allq_Eval <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Eval)
age_allq_Cust <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Cust)
age_allq_Unit <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Unit)
age_allq_Sup <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Sup)
age_allq_Lead <- curr_Agency %>%
select(SurveyYear.f, variable, Agency, Mean, SD) %>%
filter(variable %in% filter_allq_Lead)
# Plot results - Retention & Satisfaction - basic plot
p_age_allq_Ret<- ggplot(age_allq_Ret, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Ret <- p_age_allq_Ret+labs(title="Retention & Satisfaction Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
print(p_age_allq_Ret)
#print(p_age_allq_Ret)
picname <- paste(Xagency$abbrevs[i],"_Retention.jpg")
# Plot results - Talent Development - basic plot
p_age_allq_Tal<- ggplot(age_allq_Tal, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Tal <- p_age_allq_Tal+labs(title="Talent Development Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Tal)
picname <- paste(Xagency$abbrevs[i],"_Talent.jpg")
# Plot results - Work Environment - basic plot
p_age_allq_Env<- ggplot(age_allq_Env, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Env <- p_age_allq_Env+labs(title="Work Environment Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Env)
picname <- paste(Xagency$abbrevs[i],"_WorkEnvironment.jpg")
# Plot results - Worker Evaluations - basic plot
p_age_allq_Eval <- ggplot(age_allq_Eval, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Eval <- p_age_allq_Eval+labs(title="Worker Evaluations Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Eval)
picname <- paste(Xagency$abbrevs[i],"_Evaluations.jpg")
# Plot results - Customer Interactions - basic plot
p_age_allq_Cust<- ggplot(age_allq_Cust, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Cust <- p_age_allq_Cust+labs(title="Customer Interactions Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Cust)
picname <- paste(Xagency$abbrevs[i],"_Customer.jpg")
# Plot results - Work Unit - basic plot
p_age_allq_Unit<- ggplot(age_allq_Unit, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Unit <- p_age_allq_Unit+labs(title="Work Unit Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Unit)
picname <- paste(Xagency$abbrevs[i],"_WorkUnit.jpg")
# Plot results - Supervision - basic plot
p_age_allq_Sup<- ggplot(age_allq_Sup, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Sup <- p_age_allq_Sup+labs(title="Supervision Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Sup)
picname <- paste(Xagency$abbrevs[i],"_Supervisor.jpg")
# Plot results - Leadership - basic plot
p_age_allq_Lead <- ggplot(age_allq_Lead, aes(x=variable, y=Mean, fill=SurveyYear.f)) +
geom_bar(stat="identity", color="black",
position=position_dodge()) +
geom_errorbar(aes(ymin=Mean-2*SD, ymax=Mean+2*SD), width=.2,
position=position_dodge(.9))
# Cleaned up bar plot
p_age_allq_Lead <- p_age_allq_Lead+labs(title="Leadership Average Scores, Mean & 95% Confidence Interval", x="Survey Question", y = "Average Score")+
theme_minimal()+scale_fill_discrete(name = "Survey Year") +
theme(axis.text.x=element_text(angle=15, hjust=1))
#print(p_age_allq_Lead)
picname <- paste(Xagency$abbrevs[i],"_Leadership.jpg")
source('~/GitHub/DunnEES/AgencyTrends.R', echo=TRUE)
